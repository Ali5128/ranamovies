<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RanaMovies - Watch & Download Latest Movies</title>
    
    <!-- SEO & Performance -->
    <meta name="description" content="Watch and download the latest movies for free on RanaMovies. Stream your favorite releases in HD quality with fast loading times and a massive library.">
    <meta name="keywords" content="movies, download movies, watch movies, free movies, latest movies, HD movies, rana movies, streaming">
    <link rel="canonical" href="https://ranafilms.netlify.app">
    <meta name="robots" content="index, follow">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://fonts.googleapis.com" crossorigin>
    
    <!-- Stylesheets -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    
    <!-- Ads -->
    <script async src='//pl27524558.effectivecpmrate.com/71/83/b1/7183b1383f16d7f1a0d405394a2dd75c.js'></script>
    <script async src='//pl27524576.effectivecpmrate.com/ca/9c/db/ca9cdb817787e3f562770f4cfc742404.js'></script>

    <style>
        :root { --primary: #e50914; --primary-hover: #ff0f1f; --dark: #141414; --darker: #0b0b0b; --card: #1a1a1a; --text: #ffffff; --text-muted: #999999; --admin-text: #e6e6e6; --admin-input-bg: #2a2a2a; --admin-card: #1f1f1f; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: var(--dark); color: var(--text); line-height: 1.6; }
        .hidden { display: none !important; }
        #loadingSpinner { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: flex; justify-content: center; align-items: center; flex-direction: column; z-index: 9999; }
        .spinner { width: 40px; height: 40px; border: 3px solid transparent; border-top-color: var(--primary); border-radius: 50%; animation: spin 0.8s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .navbar { background: linear-gradient(180deg, rgba(0,0,0,0.9) 0%, transparent 100%); padding: 15px 0; position: fixed; width: 100%; top: 0; z-index: 100; transition: background-color 0.3s; }
        .navbar.scrolled { background: rgba(0,0,0,0.95); }
        .hero { min-height: 75vh; padding-top: 60px; background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://assets.nflxext.com/ffe/siteui/vlv3/f669a8f4-de1e-49d7-bb56-c9bd1f4a9069/d4f217b2-4001-4df5-b363-27a31d9a9b99/US-en-20221031-popsignuptwoweeks-perspective_alpha_website_large.jpg') center/cover; display: flex; align-items: center; text-align: center; }
        .movie-card { background: var(--card); border-radius: 10px; overflow: hidden; transition: transform 0.2s; height: 100%; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.2); display: flex; flex-direction: column; }
        .movie-card:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(229, 9, 20, 0.3); }
        .thumbnail-container { width: 100%; height: 350px; overflow: hidden; background-color: #222; }
        .movie-card img { width: 100%; height: 100%; object-fit: cover; transition: transform 0.3s; }
        .movie-card:hover img { transform: scale(1.05); }
        .movie-info { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; }
        .movie-title { font-size: 18px; font-weight: 600; margin-bottom: 10px; color: var(--text); flex-grow: 1; }
        .watch-btn { margin-top: auto; }
        .alert { position: fixed; top: 80px; right: 20px; z-index: 9999; padding: 15px 25px; border-radius: 8px; animation: slideIn 0.3s ease; display: none; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    </style>
</head>
<body>
    <div id="loadingSpinner" class="hidden">
        <div class="spinner"></div><p style="margin-top:10px;color:#999">Loading...</p>
    </div>

    <div class="alert" role="alert" id="alertBox"></div>

    <main id="mainSection">
        <nav class="navbar navbar-expand-lg">
            <div class="container"><a class="navbar-brand" href="#"><span style="color:var(--primary)">RANA</span><span style="color:var(--text)">MOVIES</span></a></div>
        </nav>
        <header class="hero">
            <div class="container">
                <h1 class="display-4 mb-3">Welcome to RanaMovies</h1><p class="lead mb-4">Watch and download your favorite movies</p>
                <div class="mx-auto" style="max-width:600px; display:flex;">
                    <input type="text" id="searchInput" class="form-control" placeholder="Search movies..." style="border-radius:25px 0 0 25px;padding:15px 25px;">
                    <button class="btn" style="background:linear-gradient(45deg, var(--primary), var(--primary-hover));color:white;border-radius:0 25px 25px 0;"><i class="fas fa-search"></i></button>
                </div>
            </div>
        </header>
        <div class="ad-container mx-auto" style="max-width:728px;min-height:90px;"><div id="container-7183b1383f16d7f1a0d405394a2dd75c"></div></div>
        <section class="container py-5"><h2 class="h4 mb-4">Latest Added</h2><div class="row" id="latestGrid"></div></section>
        <div class="ad-container mx-auto" style="max-width:728px;min-height:90px;"><div id="container-ca9cdb817787e3f562770f4cfc742404"></div></div>
        <section class="container py-5"><h2 class="h4 mb-4">All Movies</h2><div class="row" id="moviesGrid"></div></section>
    </main>

    <div id="adminSection" class="hidden" style="min-height:100vh;padding:30px 20px;background:var(--darker);">
        <div class="mx-auto" style="background:var(--admin-card);padding:30px;border-radius:15px;max-width:600px;margin:40px auto;">
            <div id="loginForm">
                <h3 class="text-center mb-4" style="color:var(--primary);">Admin Login</h3>
                <div class="mb-3"><label for="username">Username</label><input type="text" class="form-control" id="username"></div>
                <div class="mb-3"><label for="password">Password</label><input type="password" class="form-control" id="password"></div>
                <button class="btn btn-danger w-100" onclick="login()">Login</button>
                <div id="loginError" class="text-danger small mt-2"></div>
            </div>
            <div id="dashboard" class="hidden">
                <div class="d-flex justify-content-between align-items-center mb-4"><h3 style="color:var(--primary);">Admin Dashboard</h3><button class="btn btn-outline-light btn-sm" onclick="logout()">Logout</button></div>
                <form id="addMovieForm" onsubmit="addOrUpdateMovie(event)">
                    <input type="hidden" id="movieId">
                    <div class="mb-3"><label>Movie Title</label><input type="text" class="form-control" id="movieTitle" required></div>
                    <div class="mb-3"><label>Thumbnail URL</label><input type="url" class="form-control" id="thumbnailUrl" required></div>
                    <div class="mb-3"><label>Fallback Thumbnail URL (Optional)</label><input type="url" class="form-control" id="fallbackThumbnailUrl"></div>
                    <div class="mb-3"><label>Movie URL</label><input type="url" class="form-control" id="movieUrl" required></div>
                    <div class="row"><div class="col-md-6 mb-3"><label>Genre</label><input type="text" class="form-control" id="movieGenre" required></div><div class="col-md-6 mb-3"><label>Year</label><input type="number" class="form-control" id="movieYear" required></div></div>
                    <div class="mb-3"><label>Description</label><textarea class="form-control" id="movieDescription" rows="3" required></textarea></div>
                    <button type="submit" class="btn btn-danger w-100">Add Movie</button>
                </form>
                <hr class="my-4"><h3 style="color:var(--primary);">Manage Movies</h3><div id="moviesList" class="mt-3"></div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbwzr9YvIUfoAVLVCopwiGUBFHujaRTekoYtV8DeETpnfG2BsNloYueuPqMuWkddX3Iq/exec'; // <-- IMPORTANT!
    const ADMIN = { username: 'Jello', password: 'AliHaider5128@.com' };
    let allMovies = [];

    const ui = {
        loadingSpinner: document.getElementById('loadingSpinner'),
        mainSection: document.getElementById('mainSection'),
        adminSection: document.getElementById('adminSection'),
        alertBox: document.getElementById('alertBox'),
        moviesGrid: document.getElementById('moviesGrid'),
        latestGrid: document.getElementById('latestGrid'),
        searchInput: document.getElementById('searchInput'),
        loginForm: document.getElementById('loginForm'),
        dashboard: document.getElementById('dashboard'),
        loginError: document.getElementById('loginError'),
        moviesList: document.getElementById('moviesList'),
        addMovieForm: document.getElementById('addMovieForm'),
    };

    const showLoading = () => ui.loadingSpinner.classList.remove('hidden');
    const hideLoading = () => ui.loadingSpinner.classList.add('hidden');

    function showAlert(message, isError = false) {
        ui.alertBox.textContent = message;
        ui.alertBox.className = `alert ${isError ? 'alert-danger' : 'alert-success'}`;
        ui.alertBox.style.display = 'block';
        setTimeout(() => ui.alertBox.style.display = 'none', 4000);
    }

    async function fetchMovies() {
        showLoading();
        try {
            const response = await fetch(`${SCRIPT_URL}?action=getMovies`);
            if (!response.ok) throw new Error(`Network Error: ${response.statusText}`);
            const data = await response.json();
            if (data.success) {
                allMovies = data.movies;
                displayMovies(allMovies);
            } else {
                throw new Error(data.message || 'Failed to parse movies from script.');
            }
        } catch (error) {
            console.error('Fetch Movies Error:', error);
            showAlert(`Failed to load movies. Please double-check script permissions and URL.`, true);
        } finally {
            hideLoading();
        }
    }

    async function postData(action, payload) {
        showLoading();
        try {
            const response = await fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ action, ...payload })
            });
            const result = await response.json();
            if (!result.success) throw new Error(result.message);
            return result;
        } catch (error) {
            console.error('Post Data Error:', error);
            showAlert(`Operation failed: ${error.message}`, true);
            return null;
        } finally {
            hideLoading();
        }
    }

    async function addOrUpdateMovie(event) {
        event.preventDefault();
        const movie = {
            ID: `movie-${Date.now()}`,
            Title: document.getElementById('movieTitle').value,
            'Thumbnail URL': document.getElementById('thumbnailUrl').value,
            'Fallback Thumbnail URL': document.getElementById('fallbackThumbnailUrl').value,
            'Movie URL': document.getElementById('movieUrl').value,
            Genre: document.getElementById('movieGenre').value,
            Year: document.getElementById('movieYear').value,
            Description: document.getElementById('movieDescription').value,
            'Date Added': new Date().toISOString()
        };
        const result = await postData('addMovie', { movie });
        if (result) {
            showAlert('Movie added successfully!');
            ui.addMovieForm.reset();
            await fetchMovies();
        }
    }

    async function deleteMovie(movieId) {
        if (!confirm('Are you sure you want to delete this movie?')) return;
        const result = await postData('deleteMovie', { id: movieId });
        if (result) {
            showAlert('Movie deleted successfully!');
            await fetchMovies();
        }
    }
    
    function createMovieCard(movie) {
        const title = movie.Title || 'No Title', year = movie.Year || 'N/A', genre = movie.Genre || 'Uncategorized';
        const description = (movie.Description || '').substring(0, 80) + '...';
        const movieUrl = movie['Movie URL'] || '#';
        const thumbnailUrl = movie['Thumbnail URL'] || '';
        const fallbackUrl = movie['Fallback Thumbnail URL'] || 'https://via.placeholder.com/400x600.png?text=Image+Not+Found';

        return `<div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="movie-card">
                <div class="thumbnail-container"><img src="${thumbnailUrl}" alt="${title} Poster" loading="lazy" onerror="this.onerror=null; this.src='${fallbackUrl}';"></div>
                <div class="movie-info">
                    <h3 class="movie-title">${title}</h3>
                    <div class="movie-meta"><span>${year}</span> &bull; <span>${genre}</span></div>
                    <p class="movie-meta">${description}</p>
                    <a href="${movieUrl}" target="_blank" rel="noopener noreferrer" class="watch-btn btn btn-danger"><i class="fas fa-play"></i> Watch Now</a>
                </div>
            </div>
        </div>`;
    }

    function displayMovies(movies) {
        if (!movies || movies.length === 0) {
            const msg = '<div class="col-12 text-center text-muted">No movies available.</div>';
            ui.moviesGrid.innerHTML = msg; ui.latestGrid.innerHTML = msg; return;
        }
        const sorted = [...movies].sort((a, b) => new Date(b['Date Added']) - new Date(a['Date Added']));
        ui.moviesGrid.innerHTML = movies.map(createMovieCard).join('');
        ui.latestGrid.innerHTML = sorted.slice(0, 4).map(createMovieCard).join('');
        if (!ui.adminSection.classList.contains('hidden')) displayAdminMovies(sorted);
    }

    function displayAdminMovies(movies) {
        ui.moviesList.innerHTML = movies.map(m => `
            <div class="d-flex justify-content-between align-items-center p-2 mb-2 rounded" style="background:var(--admin-input-bg);">
                <div><div class="fw-bold">${m.Title || 'No Title'}</div><div class="small text-muted">${m.Genre} &bull; ${m.Year}</div></div>
                <button onclick="deleteMovie('${m.ID}')" class="btn btn-sm btn-outline-danger"><i class="fas fa-trash"></i></button>
            </div>`).join('');
    }

    ui.searchInput.addEventListener('input', e => {
        const term = e.target.value.toLowerCase().trim();
        const filtered = allMovies.filter(m => (m.Title||'').toLowerCase().includes(term) || (m.Genre||'').toLowerCase().includes(term));
        ui.moviesGrid.innerHTML = filtered.length ? filtered.map(createMovieCard).join('') : '<div class="col-12 text-center text-muted">No results found.</div>';
    });
    
    function login() {
        if (document.getElementById('username').value === ADMIN.username && document.getElementById('password').value === ADMIN.password) {
            ui.loginForm.classList.add('hidden'); ui.dashboard.classList.remove('hidden');
            ui.loginError.textContent = '';
            if(allMovies.length === 0) fetchMovies(); else displayAdminMovies(allMovies);
        } else {
            ui.loginError.textContent = 'Invalid credentials.';
        }
    }
    
    function logout() { ui.loginForm.classList.remove('hidden'); ui.dashboard.classList.add('hidden'); window.location.hash = ''; }

    function checkRoute() {
        const isAdmin = window.location.hash === '#admin';
        ui.mainSection.classList.toggle('hidden', isAdmin);
        ui.adminSection.classList.toggle('hidden', !isAdmin);
        if (!isAdmin && allMovies.length === 0) fetchMovies();
        if (isAdmin && allMovies.length > 0) displayAdminMovies([...allMovies].sort((a,b)=>new Date(b['Date Added'])-new Date(a['Date Added'])));
    }
    
    document.addEventListener('DOMContentLoaded', checkRoute);
    window.addEventListener('hashchange', checkRoute);
    </script>
</body>
</html>
